<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Futures Checker</title>
</head>
<body>
    <h1>Binance Futures USDT Pairs</h1>
    <input type="number" id="myInput" value="2.5">
    <button id="startButton">Veriyi Başlat</button><span id="myload"></span>
    <div id="result">(2 dakikada bir otomatik yenilenir. 2 dakika içinde yüzde 2.5 çıkan varsa listelenir ve sesli ikaz yapılır.)</div>

    <audio id="alarm" src="alarm.wav" preload="auto"></audio> <!-- Alarm sesi için HTML5 audio -->
    
    <script>
        // Alarm sesini çal
        function playAlarm() {
            const alarm = document.getElementById('alarm');
            alarm.play();
        }

        async function fetchFuturesData() {
            const resultDiv = document.getElementById('result');

            try {
                var inputValue = document.getElementById('myInput').value;
                // Binance USDT Futures çiftlerini al
                const exchangeInfoResponse = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
                const exchangeInfo = await exchangeInfoResponse.json();
                const usdtPairs = exchangeInfo.symbols.filter(pair => pair.quoteAsset === 'USDT').map(pair => pair.symbol);

                let foundPairs = [];

                for (let pair of usdtPairs) {
                    // Her bir paritenin son iki periyodundaki 1 dakikalık kline verilerini al
                    const klinesResponse = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${pair}&interval=1m&limit=2`);
                    const klines = await klinesResponse.json();

                    if (klines.length === 2) {
                        const openPrice = parseFloat(klines[0][1]); // İlk periyodun açılış fiyatı
                        const closePrice = parseFloat(klines[1][4]); // İkinci periyodun kapanış fiyatı

                        const percentageChange = ((closePrice - openPrice) / openPrice) * 100;

                        if (percentageChange >= inputValue) {
                            foundPairs.push(`${pair} (%${percentageChange.toFixed(2)})`);
                        }
                    }
                }

                if (foundPairs.length > 0) {
                    resultDiv.innerHTML = `<h2>Son 2 dakikada %2.5 ve üzeri yükselen pariteler:</h2><br><span>(2 dakikada bir otomatik yenilenir. 2 dakika içinde yüzde 2.5 çıkan varsa listelenir ve sesli ikaz yapılır.)</span><br><ul>${foundPairs.map(pair => `<li>${pair}</li>`).join('')}</ul>`;
                    playAlarm(); // Alarm sesi çal
                } else {
                    resultDiv.innerHTML = '<h2>Son 2 dakikada %2.5 ve üzeri yükselen bir parite bulunamadı.</h2><br><span>(2 dakikada bir otomatik yenilenir. 2 dakika içinde yüzde 2.5 çıkan varsa listelenir ve sesli ikaz yapılır.)</span><br>';
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                resultDiv.innerHTML = '<h2>Veri alınırken bir hata oluştu.</h2>';
            }
        }

        // Başlat butonuna tıklanınca veri çekme işlemini başlat
        document.getElementById('startButton').addEventListener('click', function() {
            document.getElementById("myload").innerHTML="Loading..."
            fetchFuturesData();
            setInterval(fetchFuturesData, 120000); // 2 dakika = 120000 ms
        });
    </script>
</body>
</html>
